---
name: project-manager
description: プロジェクトのワークフローを管理するPM（プロジェクトマネージャー）。「プロジェクトを開始」「新規プロジェクト」「進捗確認」「次のタスク」「続きを進めて」「承認」「○○が完了」「Agent Teamで〜」などの指示で呼び出す。プロジェクトの状態（ファイルの有無・内容）に応じて適切な処理を自動で選択する。
---

# Project Manager

プロジェクトの進行を管理する汎用オーケストレーター。プロジェクト種類に応じたワークフロースキルを呼び出し、状態管理と進捗追跡を行う。

## 対応ワークフロー

| プロジェクト種類 | ワークフロースキル | 説明 |
|------------------|-------------------|------|
| **調査プロジェクト** | `research-project-workflow` | 技術動向調査、市場調査、インタビュー中心、DD |
| コンテンツ作成 | （将来追加） | 資料・レポート作成 |
| 事業計画・戦略策定 | （将来追加） | 事業計画、戦略立案 |
| ソフトウェア開発 | （将来追加） | 開発プロジェクト |

## 呼び出し時の処理（自動ルーティング）

呼び出されたら、プロジェクトの現在の状態を自動判定して適切な処理に振り分ける。

### 判定フロー

```
1. CLAUDE.md の存在を確認
   └─ 存在しない → 【初期化フロー】へ

2. CLAUDE.md が存在する → workflow.md を読み込む
   └─ 現在の状態（フェーズ・ステップ・ステータス）を取得

3. 現在の状態を表示（進捗サマリ）

4. ステータスに応じて AskQuestion で次のアクションを提示
```

### ステータス別のアクション提示

| ステータス | 提示する選択肢 |
|-----------|--------------|
| `review_pending` | 承認して次へ進む / 修正指示を出す / スキップ |
| `not_started` | このステップを実行する / 確認のみ（何もしない） |
| `waiting_human` | 完了を報告する / 確認のみ（何もしない） |
| `in_progress` | （状況報告のみ。実行中のため選択肢なし） |
| 全ステップ `completed` | プロジェクト完了報告を生成する |

**進捗サマリの表示内容**:
- 現在のフェーズ・ステップ
- 完了済みステップと残りステップの一覧
- `Output/プロジェクトサマリ.md` が存在すれば、論点・仮説の検証状況の要約
- 次のアクションの選択肢

## フロー定義

### 初期化フロー

**トリガー**: CLAUDE.md が存在しないとき、または「プロジェクトを開始」「新規プロジェクト」

**処理手順**:

1. プロジェクト情報をヒアリング:
   - プロジェクト名
   - クライアント名（あれば）
   - 納期
   - 予算（あれば）
   - スコープ（1-2行）

2. 与件ファイルの有無を確認:
   - `Input/与件.md` や与件に相当するファイルがあるか確認
   - あれば内容を読み込む

3. **ワークフローアプローチを決定**:

   与件の内容と対応ワークフロー表を照合し、以下のいずれかを提案する。

   **パスA: 定義済みワークフローをそのまま使う**
   - 与件が定義済みワークフローの想定に合致する場合
   - 該当するワークフロースキルの SKILL.md からステップ一覧を提示
   - ユーザーの承認を得て確定

   **パスB: 定義済みワークフローをベースに修正する**
   - 定義済みに近いが、ステップの追加・省略・順序変更が必要な場合
   - ベースとなるワークフロースキルを読み込む
   - 修正案（省略するステップ、追加するステップ等）を提示
   - ユーザーの承認を得て確定
   - `workflow.md` をプロジェクトルートに作成（変更点とステップ詳細を記載）

   **パスC: カスタムワークフローを新規設計する**
   - 定義済みワークフローに合うものがない場合
   - [references/workflow-design-guide.md](references/workflow-design-guide.md) を参照
   - 与件からフェーズ・ステップを設計し、利用可能なスキルを割り当てる
   - ワークフロー案を提示
   - ユーザーの承認を得て確定
   - `workflow.md` をプロジェクトルートに作成

   いずれのパスでも、ワークフロー確定前にユーザー承認を挟む。
   AskQuestionで「承認 / 修正指示 / 別のアプローチを検討」を選ばせる。

4. `CLAUDE.md`を作成（テンプレート: [references/claude-md-template.md](references/claude-md-template.md)）
   - ヒアリング結果で変数を置換する
   - フォルダ構造（`Input/`, `Output/`, `Output/議事録/`, `Output/調査/`, `Work/`, `Meeting/`）も同時に作成

5. `workflow.md`を作成（テンプレート: [references/workflow-template.md](references/workflow-template.md)）
   - ワークフローソースに応じてチェックリストを動的生成

6. `Output/プロジェクトサマリ.md`のスケルトンを作成（テンプレート: [references/project-summary-template.md](references/project-summary-template.md)）
   - ヒアリングで得た目的・スコープのみ記入
   - 論点・仮説セクションは空テンプレートとして置く

7. 入力ファイルの有無を確認

8. Step 1開始の確認

### ステップ実行フロー

**トリガー**: 自動ルーティングで `not_started` のステップを「実行する」と選択されたとき、または「次のタスク」「続きを進めて」

**処理手順**:
1. `workflow.md`を読み込む
2. **ワークフローソースに応じてステップ詳細を取得**:
   - 定義済みワークフロー（パスA）: ワークフロースキルの SKILL.md + references/phases.md を読み込む
   - カスタムワークフロー（パスB/C）: プロジェクトルートの `workflow.md` を読み込む
3. 現在のステップの担当を確認:

   **AIタスクの場合**:
   - 連携スキルが指定されている → スキルの SKILL.md を読み込んで実行
   - 連携スキルなし → ワークフロー定義内の実行手順に従ってAIが直接実行
   - 完了後、`workflow.md`のステータスを `review_pending` に更新
   - **自動同期ルールに従い `Output/プロジェクトサマリ.md` を更新**（論点・仮説に変化があった場合）
   - **レビューゲートへ進む**

   **人間タスクの場合**:
   - ワークフロー定義の指示に従って案内
   - 「○○が完了したら教えてください」と待機

### レビューゲート

AIタスク完了後、次のステップに進む前に必ずユーザーのレビューを受ける。

**トリガー**: AIタスク完了時に自動的に実行、または自動ルーティングで `review_pending` のステップに対して「承認」を選択されたとき

**処理手順**:
1. **成果物の要約を提示**:
   - 出力ファイルのパス
   - 主要な内容・変更点の要約（3-5行）
2. **review_level に応じた品質チェック**:
   - ワークフロースキルのステップ定義で `review_level` を確認する
   - **`full`**: `quality-reviewer` SubAgentを起動し、以下を渡す:
     - 成果物ファイルパス
     - 関連する入力ファイルパス（照合が必要な場合）
     - 品質チェック項目（ワークフローのステップ定義に記載されていれば渡す。なければ省略し、quality-reviewer のデフォルト評価軸で評価させる）
   - **`light`**: quality-reviewer をスキップし、ユーザー確認のみで進む
3. **AskQuestionツールで判断を仰ぐ**:
   - **承認**: `workflow.md`のステータスを `completed` に更新、チェックリストを `[x]` に更新、次のステップに `← 現在` を移動、成果物リンクを更新、履歴に追記。次のステップを案内
   - **修正指示**: ユーザーからフィードバックを受領し、該当箇所を修正して再度レビューゲートへ
   - **スキップ**: `workflow.md`のステータスを `skipped` に更新、チェックリストを `[-]` に更新し、次のステップへ進む
4. **自動同期ルールに従い `Output/プロジェクトサマリ.md` を更新**（論点・仮説に変化があった場合）

### 人間タスク完了処理

**トリガー**: 自動ルーティングで `waiting_human` のステップに対して「完了を報告する」を選択、または「○○が完了」「○○しました」

**処理手順**:
1. 完了したタスクを特定
2. 成果物の格納場所を確認（必要に応じて）
3. `workflow.md`を更新
4. 報告内容に論点・仮説の変化が含まれる場合（例: クライアント方針変更の伝達）、**自動同期ルールに従い `Output/プロジェクトサマリ.md` を更新**
5. 次のステップ（AIタスク）の開始を提案

### Agent Team による並行処理

**トリガー**: 「Agent Teamで〜」「並行処理で〜」「チームで〜」

**処理手順**:

1. **AskQuestionでユーザーに確認**: 「Agent TeamはClaude Code固有の機能です。Claude Codeで実行しますか？」
   - **「はい」** → 以下のステップ2〜5に進む
   - **「いいえ」** → 「逐次ワークフローで対応します。『次のタスク』で各ステップを順に実行します」と案内して終了
2. `workflow.md`を読み込み、現在のフェーズ・進捗を確認
3. `agent-team-playbook` スキル（`skills/agent-team-playbook/SKILL.md`）を読み込む
4. 現在のフェーズに適したテンプレートを選択:
   - Phase 0（提案前）: `templates/proposal.md`
   - Phase 1（インタビュー後、文字起こしが複数ある場合）: `templates/post-interview.md`
   - Phase 2（分析方向性確定後）: `templates/report.md`
5. テンプレート内の `{変数}` をプロジェクトの現在の状態で置換:
   - 実在するファイルパス（Input/, Output/ の中身を確認）
   - プロジェクトサマリから抽出した論点・仮説
6. カスタマイズした team-prompt を生成し、ユーザーに提示する

## 状態管理

プロジェクトの状態は3ファイルで管理する。

| ファイル | 役割 | 自動ロード | 更新 |
|---------|------|-----------|------|
| `CLAUDE.md` | 静的基本情報（概要・作業上の注意・ファイル配置） | される | 初期化時のみ |
| `workflow.md` | プロセス進捗（チェックリスト・成果物リンク・履歴・重要な意思決定） | されない（PMが読む） | 自動更新 |
| `Output/プロジェクトサマリ.md` | 知識状態（論点・仮説検証状況・リスク・主要発見事項） | されない（PMが読む） | 自動更新 |

- 基本情報（クライアント名・納期等）は `CLAUDE.md` にのみ持つ
- 論点・仮説の検証状況・リスクは `Output/プロジェクトサマリ.md` で管理する。workflow.md には持たない
- 成果物リンク・進捗チェックリスト・履歴は `workflow.md` にのみ持つ
- テンプレート: `CLAUDE.md` → [references/claude-md-template.md](references/claude-md-template.md)、`workflow.md` → [references/workflow-template.md](references/workflow-template.md)、`プロジェクトサマリ` → [references/project-summary-template.md](references/project-summary-template.md)

### 自動同期ルール

以下の要素に変化が生じた場合、ユーザーの指示を待たず対応するファイルを更新する。`CLAUDE.md` は更新しない。

| 変化の対象 | 更新先 | 更新箇所 |
|-----------|--------|---------|
| 論点の追加・削除・変更 | Output/プロジェクトサマリ.md | 論点と仮説の検証状況 |
| 仮説の追加・状態変化 | Output/プロジェクトサマリ.md | 論点と仮説の検証状況 |
| リスクの発見・変化 | Output/プロジェクトサマリ.md | リスク・懸念事項 |
| 重要なファクトの発見 | Output/プロジェクトサマリ.md | 主要な発見事項ログ |
| タスク・スケジュールの変更 | workflow.md | チェックリスト |
| スコープ変更・方針転換 | workflow.md + Output/プロジェクトサマリ.md | 重要な意思決定 + 該当箇所 + 履歴 |
| ステップの状態変化 | workflow.md | 現在の状態、チェックリスト、履歴 |

変化はあらゆる場面で起こりうる。特定ステップに限定せず、判断基準で運用する:

- AIがステップを実行した結果、論点・仮説に変化が生じた → `Output/プロジェクトサマリ.md` を即時更新
- レビューでユーザーから修正指示が出た → 修正後に更新
- 人間タスク完了報告でクライアント方針変更が伝えられた → 即時更新
- ユーザーが「論点を追加したい」「スコープを変更したい」と指示した → 即時更新
- ステップの状態が変わった → `workflow.md` を必ず更新

変化がない場合は更新しない（不要な差分を生まない）。

## ワークフロー実行のルール

### 定義済みワークフロー（パスA）の場合

1. **プロジェクト初期化時**: 対応するワークフロースキルを特定し、SKILL.mdを読み込む
2. **ステップ実行時**: ワークフロースキルの指示に従い、必要な連携スキルを呼び出す
3. **スキル読み込み順序**:
   ```
   1. project-manager（このスキル）
   2. 対応するワークフロースキル（例: research-project-workflow）
   3. ステップで必要な連携スキル（例: interview-research-proposal）
   ```

### カスタムワークフロー（パスB/C）の場合

1. **プロジェクト初期化時**: `workflow.md` をプロジェクトルートに作成
2. **ステップ実行時**: `workflow.md` のステップ詳細を参照し、連携スキルがあれば読み込んで実行
3. **スキル読み込み順序**:
   ```
   1. project-manager（このスキル）
   2. プロジェクトルートの workflow.md
   3. ステップで指定された連携スキル（あれば）
   ```
4. **パスBの場合**: 変更のないステップは元のワークフロースキルの定義を参照する

### 呼び出し例

**定義済み（調査プロジェクト）**:
```
1. skills/research-project-workflow/SKILL.md を読み込む
2. ワークフローのステップ一覧を取得
3. 現在のステップに必要な連携スキルを確認
4. 連携スキルのSKILL.mdを読み込んで実行
```

**カスタム**:
```
1. プロジェクトルートの workflow.md を読み込む
2. 現在のステップの詳細を取得
3. 連携スキルが指定されていれば SKILL.md を読み込んで実行
4. 連携スキルなしなら workflow.md 内の実行手順に従って直接実行
```

## 新しいワークフロースキルの追加

project-manager は汎用オーケストレーターであり、プロジェクト固有のステップ定義はワークフロースキル側に持つ。新しいプロジェクト種類に対応するには、ワークフロースキルを追加してこのスキルに登録する。

### 追加手順

1. `skills/` に新しいワークフロースキルのディレクトリを作成
2. 以下の構造でファイルを配置:
   ```
   skills/{workflow-name}/
   ├── SKILL.md                  # ワークフロー定義（概要・ステップ一覧・連携スキル）
   └── references/
       └── phases.md             # ステップ別の詳細手順（入力・出力・品質チェック）
   ```
3. このスキル（project-manager）の「対応ワークフロー」表に行を追加
4. `references/workflow-template.md` の「ワークフロースキルの対応」表に行を追加

### ワークフロースキルの必須要素

**SKILL.md** に含めるもの:
- フロントマターの `description` に「project-managerから呼び出される」旨を記載
- ワークフロー概要（フェーズ・ステップの一覧図）
- 各ステップの担当（`[AI]` / `[人間]` / `[AI → SubAgent]`）
- 連携スキル・SubAgentの対応表
- 成果物一覧（ファイル名と格納先）

**references/phases.md** に含めるもの:
- 各ステップの詳細（目的・入力・出力・実行手順・品質チェック）
- 人間タスクの場合はAIが行う案内内容と完了条件

### 既存ワークフローの参照例

調査プロジェクト用の `research-project-workflow` が実装済み。新規作成時の構造・粒度の参考になる。

```
skills/research-project-workflow/
├── SKILL.md                  # 3フェーズ・13ステップの概要と連携スキル定義
└── references/
    └── phases.md             # 各ステップの詳細な実行手順
```
