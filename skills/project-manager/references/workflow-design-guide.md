# ワークフロー設計ガイド

与件や提案書の内容に基づき、プロジェクト固有のワークフローを設計する際のガイドライン。定義済みワークフローに合わない場合、このガイドに従ってカスタムワークフローを設計する。

---

## 設計原則

### フェーズ構造

ワークフローは2〜4フェーズで構成する。典型的な分割パターンは以下のとおり。

| パターン | フェーズ構成 | 適用場面 |
|----------|------------|----------|
| 調査型 | 提案 → 調査 → 分析・とりまとめ | デスクリサーチ、インタビュー、DD |
| 制作型 | 企画 → 制作 → レビュー・納品 | レポート、資料、スライド作成 |
| 戦略型 | 現状分析 → 戦略設計 → 実行計画 | 事業計画、戦略立案 |
| 混合型 | 上記の組み合わせ | 複合的なプロジェクト |

どのパターンにも当てはまらない場合、与件の目的から逆算してフェーズを設計する。フェーズの名前は内容を具体的に表すものにする。

### ステップ粒度

- 1ステップ = 1つの明確な成果物を生み出す作業単位
- 1ステップの目安は、AIなら1セッションで完了できる規模
- ステップが大きすぎる場合は分割する。小さすぎる場合は統合する
- 全体で5〜15ステップが目安。20ステップを超える場合はスコープを見直す

### AI/人間の分担基準

| 担当 | 基準 | 表記 |
|------|------|------|
| AI | スキルで自動実行できる、または指示に従って文書を生成・分析する作業 | `[AI]` |
| AI → SubAgent | 大量の中間出力が発生し、コンテキスト分離が必要な作業 | `[AI → SubAgent]` |
| 人間 | 外部とのやり取り、クライアントへの確認、インタビュー実施、最終判断 | `[人間]` |

AIが判断しきれない意思決定はステップの前後に人間レビューポイントを入れる。全AIステップはレビューゲート（quality-reviewer + ユーザー承認）を経て次へ進む。

---

## 利用可能なスキル・SubAgent

ステップに連携スキルを割り当てることで、品質の安定した実行ができる。連携スキルなしのステップはAIがワークフロー定義内の実行手順に従って直接実行する。

### スキル

| スキル | 用途 | 入力 | 出力 |
|--------|------|------|------|
| `interview-research-proposal` | 調査プロジェクトの提案書作成 | 与件情報 | 提案書（論点・仮説・見積り） |
| `interview-guide-creator` | インタビューガイド作成 | 提案書、調査結果 | 質問リスト（対象者タイプ別） |
| `interview-candidate-selector` | インタビュー対象者の選定・評価 | インタビューガイド、候補者リスト | 優先順位付き推奨候補リスト |
| `interview-minutes-creator` | インタビュー文字起こしから議事録作成 | 文字起こし、質問リスト | 構造化された議事録 |
| `report-outline-creator` | 報告書骨子の設計 | 提案書、調査結果 | 章立て・スライド構成 |
| `desk-research` | デスクトップリサーチ実行 | 論点・仮説 | 調査レポート、仮説検証シート |
| `meeting-minutes-creator` | 会議メモから議事録作成 | 会議メモ | 議事録（アジェンダ・ToDo・合意事項） |
| `docx-to-markdown-with-references` | Word → Markdown変換 | .docxファイル | 参考文献整理済みMarkdown |
| `slide-structure-designer` | スライドのページ構成をMDで設計 | ソースドキュメント | スライド構成MD |

### SubAgent

| SubAgent | 用途 | 使い分け |
|----------|------|----------|
| `desk-researcher` | デスクリサーチの委譲実行 | 検索結果やWebページの大量中間出力をコンテキスト分離したい場合 |
| `quality-reviewer` | 成果物の品質チェック | 全AIステップのレビューゲートで自動使用 |

---

## ステップ定義のフォーマット

各ステップに以下の要素を定義する。

```markdown
### Step N: {ステップ名} [{担当}]

**目的**: このステップで達成すること（1文）

**入力**:
- `{ファイルパス}` または {情報の説明}

**出力**:
- `{ファイルパス}`

**連携スキル**: {スキル名}（なければ「なし」）

**実行手順**:
1. {手順1}
2. {手順2}
3. ...

**品質チェック**:
- {チェック項目1}
- {チェック項目2}
```

連携スキルがある場合、実行手順にはスキルの読み込みと入力の受け渡しを書く。
連携スキルがない場合、AIが直接実行できる具体的な手順を書く。

---

## workflow.md 出力フォーマット

カスタムワークフローはプロジェクトルートに `workflow.md` として保存する。定義済みワークフロースキルの SKILL.md と references/phases.md を1ファイルに統合した構造。

```markdown
# ワークフロー: {プロジェクト名}

## 概要
- ベース: カスタム設計 / {定義済みワークフロー名} をベースに修正
- 設計根拠: {与件のどの要素からこの構成にしたか}

## ワークフロー概要

Phase 0: {フェーズ名}
  1. {ステップ名} [{担当}] → {連携スキル}
  2. {ステップ名} [{担当}]
  ...

Phase 1: {フェーズ名}
  3. {ステップ名} [{担当}] → {連携スキル}
  ...

## 連携スキル・SubAgent

| ステップ | スキル / SubAgent | 用途 |
|----------|-------------------|------|
| Step 1 | {スキル名} | {用途} |
| ... | ... | ... |

## 成果物一覧

| ステップ | 成果物 | 格納先 |
|----------|--------|--------|
| Step 1 | {成果物名} | `Output/{ファイル名}` |
| ... | ... | ... |

## ステップ詳細

### Step 1: {ステップ名} [{担当}]

**目的**: ...

**入力**:
- ...

**出力**:
- ...

**連携スキル**: ...

**実行手順**:
1. ...

**品質チェック**:
- ...

---

### Step 2: {ステップ名} [{担当}]
...
```

---

## 定義済みワークフローの修正（パスB）

定義済みワークフローをベースに修正する場合、変更内容を `workflow.md` に記録する。

### 修正できる内容

- **ステップの省略**: 不要なステップをスキップ指定
- **ステップの追加**: 既存ステップの間に新しいステップを挿入
- **順序の変更**: ステップの実行順を入れ替え
- **担当の変更**: AI ↔ 人間の切り替え
- **連携スキルの変更**: 別のスキルに差し替え

### 修正時の workflow.md 記載

```markdown
## 概要
- ベース: research-project-workflow をベースに修正
- 設計根拠: インタビューが不要なため、Phase 1のインタビュー関連ステップを省略

## 変更点
- Step 5（インタビューガイド作成）: 省略
- Step 7（インタビュー対象者選定）: 省略
- (インタビュー実施): 省略
- Step 8（インタビュー議事メモ作成）: 省略
- Step 9（インタビューまとめ）: 省略
- Step 10（デスクリサーチ）: Phase 1の主要ステップに昇格
- Step 6A（追加）: ワークショップ設計 [AI] → 新規ステップ
```

変更点以外のステップは元のワークフロースキルの定義をそのまま使う。`workflow.md` には変更・追加したステップの詳細のみを記載する。

---

## 運用サイクル

カスタムワークフローから定義済みワークフローへの昇格:

1. カスタムワークフローで複数プロジェクトを実行し、パターンの安定を確認する
2. `skills/{new-workflow}/` にワークフロースキルとして切り出す
   - `SKILL.md`（概要・ステップ一覧・連携スキル）
   - `references/phases.md`（ステップ詳細）
3. `project-manager/SKILL.md` の対応ワークフロー表に追加
4. `references/workflow-template.md` のワークフロースキル対応表に追加
